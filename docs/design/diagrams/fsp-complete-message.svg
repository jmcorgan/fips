<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 580 524" font-family="monospace" font-size="13">
  <!-- Background -->
  <rect width="580" height="524" fill="#1a1a2e" rx="4"/>

  <!-- Title -->
  <text x="310" y="26" fill="#e0e0e0" text-anchor="middle" font-size="14" font-weight="bold">FSP Complete Encrypted Message (34 + body bytes)</text>

  <!-- Bit ruler -->
  <text x="85" y="50" fill="#888" font-size="10" text-anchor="middle">0</text>
  <text x="150" y="50" fill="#888" font-size="10" text-anchor="middle">4</text>
  <text x="215" y="50" fill="#888" font-size="10" text-anchor="middle">8</text>
  <text x="345" y="50" fill="#888" font-size="10" text-anchor="middle">16</text>
  <text x="550" y="50" fill="#888" font-size="10" text-anchor="middle">32</text>

  <!-- Row 0: Common prefix (bytes 0-3) -->
  <text x="50" y="82" fill="#666" font-size="10" text-anchor="end">0–3</text>

  <rect x="55" y="56" width="95" height="52" fill="#2d4a7a" stroke="#4a90d9" stroke-width="1.5" rx="3"/>
  <text x="102" y="80" fill="#e0e0e0" text-anchor="middle" font-size="12" font-weight="bold">ver</text>
  <text x="102" y="98" fill="#8ab4f8" text-anchor="middle" font-size="10">4 bits</text>

  <rect x="150" y="56" width="95" height="52" fill="#2d5a4a" stroke="#4ad99a" stroke-width="1.5" rx="3"/>
  <text x="197" y="80" fill="#e0e0e0" text-anchor="middle" font-size="12" font-weight="bold">phase</text>
  <text x="197" y="98" fill="#8af8c8" text-anchor="middle" font-size="10">4 bits</text>

  <rect x="245" y="56" width="130" height="52" fill="#5a3d2d" stroke="#d9904a" stroke-width="1.5" rx="3"/>
  <text x="310" y="80" fill="#e0e0e0" text-anchor="middle" font-size="12" font-weight="bold">flags</text>
  <text x="310" y="98" fill="#f8c88a" text-anchor="middle" font-size="10">1 byte</text>

  <rect x="375" y="56" width="200" height="52" fill="#4a2d5a" stroke="#b04ad9" stroke-width="1.5" rx="3"/>
  <text x="475" y="80" fill="#e0e0e0" text-anchor="middle" font-size="12" font-weight="bold">payload_len</text>
  <text x="475" y="98" fill="#d8a0f8" text-anchor="middle" font-size="10">2 bytes LE</text>

  <!-- Row 1: counter low (bytes 4-7) -->
  <text x="50" y="134" fill="#666" font-size="10" text-anchor="end">4–7</text>

  <rect x="55" y="108" width="520" height="52" fill="#5a2d3d" stroke="#d94a6a" stroke-width="1.5" rx="3"/>
  <text x="315" y="138" fill="#e0e0e0" text-anchor="middle" font-size="12" font-weight="bold">counter / lower 4 bytes LE</text>

  <!-- Row 2: counter high (bytes 8-11) -->
  <text x="50" y="186" fill="#666" font-size="10" text-anchor="end">8–11</text>

  <rect x="55" y="160" width="520" height="52" fill="#5a2d3d" stroke="#d94a6a" stroke-width="1.5" rx="3"/>
  <text x="315" y="190" fill="#e0e0e0" text-anchor="middle" font-size="12" font-weight="bold">counter / upper 4 bytes LE</text>

  <!-- AAD bracket -->
  <text x="10" y="134" fill="#777" font-size="10" text-anchor="middle" transform="rotate(-90, 10, 134)">AAD</text>
  <line x1="18" y1="56" x2="18" y2="212" stroke="#555" stroke-width="1"/>
  <line x1="18" y1="56" x2="23" y2="56" stroke="#555" stroke-width="1"/>
  <line x1="18" y1="212" x2="23" y2="212" stroke="#555" stroke-width="1"/>

  <!-- Optional coords -->
  <text x="50" y="238" fill="#666" font-size="10" text-anchor="end">opt</text>

  <rect x="55" y="220" width="520" height="40" fill="#1f1f3a" stroke="#4ad99a" stroke-width="1" stroke-dasharray="4,3" rx="3"/>
  <text x="315" y="244" fill="#8af8c8" text-anchor="middle" font-size="11">cleartext coordinates (if CP flag set, variable length)</text>

  <!-- Separator: ciphertext below -->
  <line x1="55" y1="268" x2="575" y2="268" stroke="#555" stroke-width="1" stroke-dasharray="6,4"/>
  <text x="315" y="284" fill="#777" font-size="10" text-anchor="middle">── ciphertext (encrypted with ChaCha20-Poly1305) ──</text>

  <!-- Row 3: timestamp (4 bytes, encrypted) -->
  <text x="50" y="318" fill="#666" font-size="10" text-anchor="end">+0–3</text>

  <rect x="55" y="292" width="520" height="52" fill="#3d4a2d" stroke="#8ad94a" stroke-width="1.5" rx="3"/>
  <text x="315" y="316" fill="#e0e0e0" text-anchor="middle" font-size="12" font-weight="bold">timestamp</text>
  <text x="315" y="334" fill="#c8f88a" text-anchor="middle" font-size="10">4 bytes LE</text>

  <!-- Row 4: msg_type (1) + inner_flags (1) + body starts -->
  <text x="50" y="370" fill="#666" font-size="10" text-anchor="end">+4</text>

  <rect x="55" y="344" width="130" height="52" fill="#4a3d2d" stroke="#d9b04a" stroke-width="1.5" rx="3"/>
  <text x="120" y="368" fill="#e0e0e0" text-anchor="middle" font-size="12" font-weight="bold">msg_type</text>
  <text x="120" y="386" fill="#f8d88a" text-anchor="middle" font-size="10">1 byte</text>

  <rect x="185" y="344" width="130" height="52" fill="#3d3d2d" stroke="#a0a04a" stroke-width="1.5" rx="3"/>
  <text x="250" y="368" fill="#e0e0e0" text-anchor="middle" font-size="12" font-weight="bold">inner_flags</text>
  <text x="250" y="386" fill="#d8d88a" text-anchor="middle" font-size="10">1 byte</text>

  <rect x="315" y="344" width="260" height="52" fill="#1f1f3a" stroke="#444" stroke-width="1" stroke-dasharray="4,3" rx="3"/>
  <text x="445" y="374" fill="#666" text-anchor="middle" font-size="11">body ...</text>

  <!-- Row 5: body variable -->
  <text x="50" y="422" fill="#666" font-size="10" text-anchor="end">...</text>

  <rect x="55" y="396" width="520" height="52" fill="#1f1f3a" stroke="#444" stroke-width="1" stroke-dasharray="4,3" rx="3"/>
  <text x="315" y="426" fill="#666" text-anchor="middle" font-size="11">message body (variable length)</text>

  <!-- AEAD tag -->
  <text x="50" y="468" fill="#666" font-size="10" text-anchor="end">+16</text>

  <rect x="55" y="452" width="520" height="30" fill="#4a2d4a" stroke="#b04ab0" stroke-width="1.5" rx="3"/>
  <text x="315" y="472" fill="#e0e0e0" text-anchor="middle" font-size="11" font-weight="bold">Poly1305 AEAD tag (16 bytes)</text>

  <!-- Totals -->
  <text x="310" y="510" fill="#777" font-size="10" text-anchor="middle">overhead: 34 bytes (12 header + 6 inner + 16 tag) · coords add variable length</text>
</svg>
