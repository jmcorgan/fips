<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 860 680" font-family="monospace" font-size="12">
  <style>
    rect.node     { fill: #2e3a5e; stroke: #5080c0; stroke-width: 2; rx: 6; }
    rect.cache    { fill: #151520; stroke: #404060; stroke-width: 1; rx: 3; }
    rect.phase    { fill: none; stroke: none; }
    text          { fill: #e0e0e0; }
    text.title    { font-size: 16px; font-weight: bold; }
    text.subtitle { font-size: 12px; fill: #909090; }
    text.nlabel   { font-size: 13px; font-weight: bold; }
    text.nrole    { font-size: 10px; fill: #909090; }
    text.plabel   { font-size: 13px; font-weight: bold; fill: #909090; }
    text.annot    { font-size: 10px; fill: #909090; font-style: italic; }
    text.alabel   { font-size: 11px; }
    text.clabel   { font-size: 9px; fill: #c0c0c0; }
    text.caption  { font-size: 11px; fill: #707080; font-style: italic; }
    line.sep      { stroke: #303040; stroke-width: 1; stroke-dasharray: 6,4; }
    line.life     { stroke: #303040; stroke-width: 1; stroke-dasharray: 2,3; }
    line.disco    { stroke: #5080c0; stroke-width: 2; }
    line.resp     { stroke: #d0a040; stroke-width: 2; stroke-dasharray: 6,3; }
    line.data     { stroke: #40a060; stroke-width: 2; }
    polygon.disco { fill: #5080c0; }
    polygon.resp  { fill: #d0a040; }
    polygon.data  { fill: #40a060; }
  </style>

  <!-- Background -->
  <rect width="860" height="680" fill="#0d1117" rx="8"/>

  <!-- Title -->
  <text x="430" y="28" text-anchor="middle" class="title">Coordinate Discovery and Caching</text>
  <text x="430" y="46" text-anchor="middle" class="subtitle">LookupRequest/Response warms caches along the path</text>

  <!-- ═══ Node headers ═══ -->
  <!-- Node positions: A=160, B=340, C=520, D=700 -->

  <!-- Node A — Source -->
  <rect x="110" y="68" width="100" height="42" class="node"/>
  <text x="160" y="88" text-anchor="middle" class="nlabel">A</text>
  <text x="160" y="101" text-anchor="middle" class="nrole">Source</text>

  <!-- Node B — Transit -->
  <rect x="290" y="68" width="100" height="42" class="node"/>
  <text x="340" y="88" text-anchor="middle" class="nlabel">B</text>
  <text x="340" y="101" text-anchor="middle" class="nrole">Transit</text>

  <!-- Node C — Transit -->
  <rect x="470" y="68" width="100" height="42" class="node"/>
  <text x="520" y="88" text-anchor="middle" class="nlabel">C</text>
  <text x="520" y="101" text-anchor="middle" class="nrole">Transit</text>

  <!-- Node D — Destination -->
  <rect x="650" y="68" width="100" height="42" class="node"/>
  <text x="700" y="88" text-anchor="middle" class="nlabel">D</text>
  <text x="700" y="101" text-anchor="middle" class="nrole">Destination</text>

  <!-- ═══ Lifelines ═══ -->
  <line x1="160" y1="110" x2="160" y2="620" class="life"/>
  <line x1="340" y1="110" x2="340" y2="620" class="life"/>
  <line x1="520" y1="110" x2="520" y2="620" class="life"/>
  <line x1="700" y1="110" x2="700" y2="620" class="life"/>

  <!-- ═══════════════════════════════════════════════ -->
  <!-- Phase 1 — Discovery (y: 130–290) -->
  <!-- ═══════════════════════════════════════════════ -->

  <text x="40" y="148" text-anchor="middle" class="plabel">Phase 1</text>
  <text x="40" y="164" text-anchor="middle" class="annot">Discovery</text>

  <!-- A → B LookupRequest -->
  <line x1="170" y1="170" x2="328" y2="170" class="disco"/>
  <polygon points="326,165 336,170 326,175" class="disco"/>
  <text x="250" y="163" text-anchor="middle" class="alabel" fill="#5080c0">LookupRequest</text>

  <!-- B → C LookupRequest -->
  <line x1="350" y1="200" x2="508" y2="200" class="disco"/>
  <polygon points="506,195 516,200 506,205" class="disco"/>
  <text x="430" y="193" text-anchor="middle" class="alabel" fill="#5080c0">LookupRequest</text>

  <!-- C → D LookupRequest -->
  <line x1="530" y1="230" x2="688" y2="230" class="disco"/>
  <polygon points="686,225 696,230 686,235" class="disco"/>
  <text x="610" y="223" text-anchor="middle" class="alabel" fill="#5080c0">LookupRequest</text>

  <!-- Bloom filter annotation -->
  <text x="430" y="260" text-anchor="middle" class="annot">guided by bloom filters at each hop</text>

  <!-- ═══ Phase separator ═══ -->
  <line x1="70" y1="285" x2="830" y2="285" class="sep"/>

  <!-- ═══════════════════════════════════════════════ -->
  <!-- Phase 2 — Response (y: 295–460) -->
  <!-- ═══════════════════════════════════════════════ -->

  <text x="40" y="318" text-anchor="middle" class="plabel">Phase 2</text>
  <text x="40" y="334" text-anchor="middle" class="annot">Response</text>

  <!-- D → C LookupResponse -->
  <line x1="690" y1="340" x2="532" y2="340" class="resp"/>
  <polygon points="534,335 524,340 534,345" class="resp"/>
  <text x="610" y="333" text-anchor="middle" class="alabel" fill="#d0a040">LookupResponse + coords</text>

  <!-- Cache box at C -->
  <rect x="490" y="358" width="60" height="22" class="cache"/>
  <text x="520" y="373" text-anchor="middle" class="clabel">cache D</text>

  <!-- C → B LookupResponse -->
  <line x1="510" y1="395" x2="352" y2="395" class="resp"/>
  <polygon points="354,390 344,395 354,400" class="resp"/>
  <text x="430" y="388" text-anchor="middle" class="alabel" fill="#d0a040">LookupResponse + coords</text>

  <!-- Cache box at B -->
  <rect x="310" y="413" width="60" height="22" class="cache"/>
  <text x="340" y="428" text-anchor="middle" class="clabel">cache D</text>

  <!-- B → A LookupResponse -->
  <line x1="330" y1="448" x2="172" y2="448" class="resp"/>
  <polygon points="174,443 164,448 174,453" class="resp"/>
  <text x="250" y="441" text-anchor="middle" class="alabel" fill="#d0a040">LookupResponse + coords</text>

  <!-- ═══ Phase separator ═══ -->
  <line x1="70" y1="475" x2="830" y2="475" class="sep"/>

  <!-- ═══════════════════════════════════════════════ -->
  <!-- Phase 3 — Efficient routing (y: 485–610) -->
  <!-- ═══════════════════════════════════════════════ -->

  <text x="40" y="508" text-anchor="middle" class="plabel">Phase 3</text>
  <text x="40" y="524" text-anchor="middle" class="annot">Routing</text>

  <!-- A → B Data -->
  <line x1="170" y1="530" x2="328" y2="530" class="data"/>
  <polygon points="326,525 336,530 326,535" class="data"/>
  <text x="250" y="523" text-anchor="middle" class="alabel" fill="#40a060">Data</text>

  <!-- Cached coords note at B -->
  <text x="340" y="553" text-anchor="middle" class="annot">cached coords</text>

  <!-- B → C Data -->
  <line x1="350" y1="565" x2="508" y2="565" class="data"/>
  <polygon points="506,560 516,565 506,570" class="data"/>
  <text x="430" y="558" text-anchor="middle" class="alabel" fill="#40a060">Data</text>

  <!-- Cached coords note at C -->
  <text x="520" y="588" text-anchor="middle" class="annot">cached coords</text>

  <!-- C → D Data -->
  <line x1="530" y1="600" x2="688" y2="600" class="data"/>
  <polygon points="686,595 696,600 686,605" class="data"/>
  <text x="610" y="593" text-anchor="middle" class="alabel" fill="#40a060">Data</text>

  <!-- Efficient forwarding annotation -->
  <text x="430" y="622" text-anchor="middle" class="annot">cached coords enable efficient forwarding — no re-discovery needed</text>

  <!-- ═══ Caption ═══ -->
  <text x="430" y="660" text-anchor="middle" class="caption">Each transit node caches coordinates from the LookupResponse return path</text>
</svg>
